<view class="container">

  <!-- 报名者名片 -->
  <view wx:if="{{cardType == 'applicant'}}">

    <!-- 头部卡片 -->
    <view class="card-header">
      <view class="card-avatar">
        <image src="{{card.avatar || '../../imgs/icon/male1.png'}}" mode="aspectFill"></image>
      </view>
      <view class="card-info">
        <view class="card-name">{{card.name || card.nickname || '未设置'}}</view>
        <view class="card-tags">
          <text wx:if="{{card.sex == 1}}">男</text>
          <text wx:if="{{card.sex == 2}}">女</text>
          <text wx:if="{{card.age > 0}}"> | {{card.age}}岁</text>
          <text wx:if="{{card.education}}"> | {{card.education}}</text>
        </view>
        <view class="card-phone">{{card.phone_mask || '未绑定手机'}}</view>
      </view>
    </view>

    <!-- 统计数据 -->
    <view class="card-stats">
      <view class="stat-item">
        <view class="stat-num">{{card.experience_count || 0}}</view>
        <view class="stat-label">兼职经历</view>
      </view>
      <view class="stat-item">
        <view class="stat-num">{{card.signin_count || 0}}</view>
        <view class="stat-label">签到次数</view>
      </view>
      <view class="stat-item">
        <view class="stat-num">{{card.nosignin_count || 0}}</view>
        <view class="stat-label">缺勤次数</view>
      </view>
      <view class="stat-item">
        <view class="stat-num rating-num">{{card.rating || '-'}}</view>
        <view class="stat-label">评价</view>
      </view>
    </view>

    <!-- 详细信息 -->
    <view class="card-section">
      <view class="section-title">个人信息</view>
      <view class="info-row">
        <text class="info-label">学校</text>
        <text class="info-value" wx:if="{{!isEditing}}">{{card.school || '未填写'}}</text>
        <input wx:if="{{isEditing}}" class="info-input" value="{{editSchool}}" bindinput="onSchoolInput" placeholder="请输入学校名称" />
      </view>
      <view class="info-row">
        <text class="info-label">专业</text>
        <text class="info-value" wx:if="{{!isEditing}}">{{card.major || '未填写'}}</text>
        <input wx:if="{{isEditing}}" class="info-input" value="{{editMajor}}" bindinput="onMajorInput" placeholder="请输入专业" />
      </view>
    </view>

    <!-- 评分展示 -->
    <view class="card-section" wx:if="{{card.rating > 0}}">
      <view class="section-title">信用评价</view>
      <view class="rating-row">
        <view class="rating-flowers">
          <image wx:for="{{5}}" wx:key="index" src="../../imgs/icon/{{index < card.rating ? 'flower_active' : 'flower'}}.png" class="flower-icon"></image>
        </view>
        <text class="rating-text">{{card.rating}}分</text>
      </view>
    </view>

    <!-- 操作按钮 -->
    <view class="card-actions" wx:if="{{card.is_self == 1}}">
      <button class="btn-edit" wx:if="{{!isEditing}}" bindtap="toggleEdit">编辑名片</button>
      <button class="btn-save" wx:if="{{isEditing}}" bindtap="saveApplicantCard">保存</button>
      <button class="btn-cancel" wx:if="{{isEditing}}" bindtap="toggleEdit">取消</button>
    </view>

    <view class="card-actions" wx:if="{{card.is_self != 1}}">
      <button class="btn-call" bindtap="unlockPhone" wx:if="{{!phoneUnlocked}}">联系TA</button>
      <button class="btn-call" bindtap="callPhone" wx:if="{{phoneUnlocked}}">拨打 {{unlockedPhone}}</button>
    </view>

  </view>

  <!-- 发布者名片 -->
  <view wx:if="{{cardType == 'publisher'}}">

    <!-- 头部卡片 -->
    <view class="pub-card-header">
      <view class="pub-logo">
        <image src="{{card.company_logo || '../../imgs/icon/gz.png'}}" mode="aspectFill"></image>
      </view>
      <view class="pub-info">
        <view class="pub-company">{{card.company_name || '未设置公司名称'}}</view>
        <view class="pub-short" wx:if="{{card.short_name}}">{{card.short_name}}</view>
        <view class="pub-meta">
          <text wx:if="{{card.companycate}}">{{card.companycate}}</text>
          <text wx:if="{{card.companytype}}"> | {{card.companytype}}</text>
          <text wx:if="{{card.companyworker}}"> | {{card.companyworker}}</text>
        </view>
      </view>
    </view>

    <!-- 统计数据 -->
    <view class="card-stats">
      <view class="stat-item">
        <view class="stat-num">{{card.job_count || 0}}</view>
        <view class="stat-label">已发岗位</view>
      </view>
      <view class="stat-item">
        <view class="stat-num rating-num">{{card.rating || '-'}}</view>
        <view class="stat-label">评价</view>
      </view>
      <view class="stat-item">
        <view class="stat-num">{{card.comment_count || 0}}</view>
        <view class="stat-label">评论数</view>
      </view>
    </view>

    <!-- 联系信息 -->
    <view class="card-section">
      <view class="section-title">联系信息</view>
      <view class="info-row">
        <text class="info-label">联系人</text>
        <text class="info-value">{{card.mastername || '未设置'}}</text>
      </view>
      <view class="info-row">
        <text class="info-label">地址</text>
        <text class="info-value">{{card.address || '未设置'}}</text>
      </view>
    </view>

    <!-- 营业执照 -->
    <view class="card-section">
      <view class="section-title">营业执照</view>
      <view wx:if="{{card.business_license && !isEditing}}">
        <image src="{{card.business_license}}" class="license-img" mode="widthFix"></image>
      </view>
      <view wx:if="{{!card.business_license && !isEditing}}" class="no-license">
        <text>未上传营业执照</text>
      </view>
      <view wx:if="{{isEditing}}" class="upload-area" bindtap="uploadLicense">
        <image wx:if="{{editLicense}}" src="{{editLicense}}" class="license-img" mode="widthFix"></image>
        <view wx:if="{{!editLicense}}" class="upload-placeholder">
          <text>点击上传营业执照</text>
        </view>
      </view>
    </view>

    <!-- 操作按钮 -->
    <view class="card-actions" wx:if="{{card.is_self == 1}}">
      <button class="btn-edit" wx:if="{{!isEditing}}" bindtap="toggleEdit">编辑名片</button>
      <button class="btn-save" wx:if="{{isEditing}}" bindtap="savePublisherCard">保存</button>
      <button class="btn-cancel" wx:if="{{isEditing}}" bindtap="toggleEdit">取消</button>
    </view>

    <view class="card-actions" wx:if="{{card.is_self != 1}}">
      <button class="btn-call" bindtap="unlockPhone" wx:if="{{!phoneUnlocked}}">联系企业</button>
      <button class="btn-call" bindtap="callPhone" wx:if="{{phoneUnlocked}}">拨打 {{unlockedPhone}}</button>
    </view>

  </view>

</view>
